# Design: AMB Tokenizer - Research to Production

## 1. System Overview

This document outlines the complete architecture for transforming the AMB (Akshara-Morpheme-BPE) tokenizer from a research prototype into a production-ready system deployable in real-world Tamil NLP applications.

### 1.1 Current Architecture (Research Phase)

The AMB tokenizer currently implements a 6-layer pipeline:

```
┌─────────────────────────────────────────────────────────────────────┐
│                    CURRENT AMB ARCHITECTURE                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  Layer 1: Deep Normalization (Tamil Unicode + ZWJ/ZWNJ cleanup)     │
│           ↓                                                          │
│  Layer 2: Script Isolation (Tamil/Latin/Digit separation)           │
│           ↓                                                          │
│  Layer 3: Morpheme Segmentation (Rule-based suffix stripping)       │
│           ↓                                                          │
│  Layer 4: Constrained BPE Training (Respects morpheme boundaries)   │
│           ↓                                                          │
│  Layer 5: Syllable Pre-population (247 Tamil syllables locked)      │
│           ↓                                                          │
│  Layer 6: Validation (Coverage + Leakage detection)                 │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 Target Architecture (Production Phase)

The production system extends the research architecture with deployment, monitoring, and integration layers:

```
┌─────────────────────────────────────────────────────────────────────┐
│                  PRODUCTION AMB ARCHITECTURE                         │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  TRAINING PIPELINE (Offline)                                 │   │
│  │  • Corpus Collection (20GB from 7 sources)                   │   │
│  │  • Normalization + Deduplication                             │   │
│  │  • AMB Training (Layers 1-6)                                 │   │
│  │  • Evaluation + Benchmarking                                 │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                          ↓                                           │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  PACKAGING LAYER                                             │   │
│  │  • Python Package (pip installable)                          │   │
│  │  • HuggingFace Integration (AutoTokenizer)                   │   │
│  │  • Model Hub Publishing                                      │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                          ↓                                           │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  DEPLOYMENT LAYER                                            │   │
│  │  • REST API (FastAPI)                                        │   │
│  │  • Docker Container                                          │   │
│  │  • Cloud Deployment (AWS/GCP/Azure)                          │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                          ↓                                           │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  MONITORING LAYER                                            │   │
│  │  • Performance Metrics (Latency, Throughput)                 │   │
│  │  • Usage Analytics                                           │   │
│  │  • Error Tracking                                            │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘
```

## 2. End-to-End Architecture Diagram


### 2.1 Complete System Architecture

```
┌───────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                         │
│                         RESEARCH TO PRODUCTION PIPELINE                                 │
│                                                                                         │
├───────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  PHASE 1: VALIDATION & OPTIMIZATION (Weeks 1-2)                                       │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                   │ │
│  │  ┌──────────────┐      ┌──────────────┐      ┌──────────────┐                  │ │
│  │  │   Existing   │      │  Re-normalize│      │  Re-train    │                  │ │
│  │  │   Corpus     │─────▶│  with Script │─────▶│  with Fixes  │                  │ │
│  │  │   (10K lines)│      │  Isolation   │      │  Applied     │                  │ │
│  │  └──────────────┘      └──────────────┘      └──────────────┘                  │ │
│  │                                                       │                          │ │
│  │                                                       ▼                          │ │
│  │                                              ┌──────────────┐                   │ │
│  │                                              │  Validation  │                   │ │
│  │                                              │  • Syllable  │                   │ │
│  │                                              │    Coverage  │                   │ │
│  │                                              │  • Leakage   │                   │ │
│  │                                              │  • Metrics   │                   │ │
│  │                                              └──────────────┘                   │ │
│  │                                                                                   │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  PHASE 2: SCALE-UP TRAINING (Weeks 3-6)                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                                                                                   │ │
│  │  ┌──────────────────────────────────────────────────────────────────────────┐  │ │
│  │  │  DATA COLLECTION (Parallel Downloads)                                     │  │ │
│  │  │                                                                            │  │ │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │  │ │
│  │  │  │ Wikipedia   │  │  CulturaX   │  │   OSCAR     │  │  IndicCorp  │    │  │ │
│  │  │  │   ~600MB    │  │    ~5GB     │  │    ~5GB     │  │    ~3GB     │    │  │ │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │  │ │
│  │  │         │                │                 │                │            │  │ │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                     │  │ │
│  │  │  │   CC-100    │  │     mC4     │  │ Samanantar  │                     │  │ │
│  │  │  │    ~3GB     │  │    ~5GB     │  │   ~500MB    │                     │  │ │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘                     │  │ │
│  │  │         │                │                 │                             │  │ │
│  │  │         └────────────────┴─────────────────┘                             │  │ │
│  │  │                          │                                                │  │ │
│  │  │                          ▼                                                │  │ │
│  │  │                 ┌──────────────────┐                                     │  │ │
│  │  │                 │  Raw Corpus      │                                     │  │ │
│  │  │                 │  ~20GB Total     │                                     │  │ │
│  │  │                 └──────────────────┘                                     │  │ │
│  │  └──────────────────────────────────────────────────────────────────────────┘  │ │
│  │                          │                                                       │ │
│  │                          ▼                                                       │ │
│  │  ┌──────────────────────────────────────────────────────────────────────────┐  │ │
│  │  │  NORMALIZATION PIPELINE (Streaming, Multi-process)                        │  │ │
│  │  │                                                                            │  │ │
│  │  │  ┌────────────────┐    ┌────────────────┐    ┌────────────────┐         │  │ │
│  │  │  │ Unicode NFC    │───▶│ Script         │───▶│ Language       │         │  │ │
│  │  │  │ Normalization  │    │ Isolation      │    │ Filtering      │         │  │ │
│  │  │  └────────────────┘    └────────────────┘    └────────────────┘         │  │ │
│  │  │                                                       │                   │  │ │
│  │  │                                                       ▼                   │  │ │
│  │  │                                              ┌────────────────┐           │  │ │
│  │  │                                              │ Deduplication  │           │  │ │
│  │  │                                              │ • Exact Hash   │           │  │ │
│  │  │                                              │ • MinHash LSH  │           │  │ │
│  │  │                                              └────────────────┘           │  │ │
│  │  │                                                       │                   │  │ │
│  │  │                                                       ▼                   │  │ │
│  │  │                                              ┌────────────────┐           │  │ │
│  │  │                                              │ Train/Eval     │           │  │ │
│  │  │                                              │ Split (98/2)   │           │  │ │
│  │  │                                              └────────────────┘           │  │ │
│  │  └──────────────────────────────────────────────────────────────────────────┘  │ │
│  │                          │                                                       │ │
│  │                          ▼                                                       │ │
│  │  ┌──────────────────────────────────────────────────────────────────────────┐  │ │
│  │  │  AMB TRAINING (GPU-Accelerated)                                           │  │ │
│  │  │                                                                            │  │ │
│  │  │  Input: Cleaned Corpus (~15GB after dedup)                                │  │ │
│  │  │  Steps: 5,000 - 50,000 training iterations                                │  │ │
│  │  │  Output: tokenizer.json (64K vocab)                                       │  │ │
│  │  └──────────────────────────────────────────────────────────────────────────┘  │ │
│  │                          │                                                       │ │
│  │                          ▼                                                       │ │
│  │  ┌──────────────────────────────────────────────────────────────────────────┐  │ │
│  │  │  EVALUATION & BENCHMARKING                                                │  │ │
│  │  │                                                                            │  │ │
│  │  │  ┌────────────────┐    ┌────────────────┐    ┌────────────────┐         │  │ │
│  │  │  │ Core Metrics   │    │ Comparison     │    │ Downstream     │         │  │ │
│  │  │  │ • Fertility    │    │ vs GPT-4       │    │ Tasks          │         │  │ │
│  │  │  │ • Coverage     │    │ vs Llama-3     │    │ • Sentiment    │         │  │ │
│  │  │  │ • Leakage      │    │ vs Baseline    │    │ • NER          │         │  │ │
│  │  │  └────────────────┘    └────────────────┘    └────────────────┘         │  │ │
│  │  └──────────────────────────────────────────────────────────────────────────┘  │ │
│  │                                                                                   │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────┘
```


### 2.2 Production Deployment Architecture

```
┌───────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                         │
│  PHASE 3-4: PACKAGING & DEPLOYMENT (Weeks 7-10)                                       │
│                                                                                         │
├───────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │  PACKAGING LAYER                                                                 │ │
│  │                                                                                   │ │
│  │  ┌────────────────────────────────────────────────────────────────────────┐    │ │
│  │  │  Python Package (tamiluku-tokenizer)                                    │    │ │
│  │  │                                                                          │    │ │
│  │  │  ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐ │    │ │
│  │  │  │  Core Library    │    │  CLI Tools       │    │  Documentation   │ │    │ │
│  │  │  │  • Tokenizer     │    │  • train         │    │  • API Reference │ │    │ │
│  │  │  │  • Normalizer    │    │  • evaluate      │    │  • Examples      │ │    │ │
│  │  │  │  • Morpheme Seg  │    │  • merge         │    │  • Tutorials     │ │    │ │
│  │  │  └──────────────────┘    └──────────────────┘    └──────────────────┘ │    │ │
│  │  │                                                                          │    │ │
│  │  │  Installation: pip install tamiluku-tokenizer                           │    │ │
│  │  └────────────────────────────────────────────────────────────────────────┘    │ │
│  │                                                                                   │ │
│  │  ┌────────────────────────────────────────────────────────────────────────┐    │ │
│  │  │  HuggingFace Integration                                                │    │ │
│  │  │                                                                          │    │ │
│  │  │  ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐ │    │ │
│  │  │  │  Model Hub       │    │  AutoTokenizer   │    │  Transformers    │ │    │ │
│  │  │  │  Publishing      │    │  Compatible      │    │  Integration     │ │    │ │
│  │  │  │                  │    │                  │    │                  │ │    │ │
│  │  │  │  • Model Card    │    │  from_pretrained │    │  • Llama         │ │    │ │
│  │  │  │  • Vocab Files   │    │  • encode()      │    │  • Qwen          │ │    │ │
│  │  │  │  • Config        │    │  • decode()      │    │  • Mistral       │ │    │ │
│  │  │  └──────────────────┘    └──────────────────┘    └──────────────────┘ │    │ │
│  │  │                                                                          │    │ │
│  │  │  Usage: AutoTokenizer.from_pretrained("tamiluku/amb-tokenizer")         │    │ │
│  │  └────────────────────────────────────────────────────────────────────────┘    │ │
│  │                                                                                   │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │  DEPLOYMENT LAYER                                                                │ │
│  │                                                                                   │ │
│  │  ┌────────────────────────────────────────────────────────────────────────┐    │ │
│  │  │  REST API Service (FastAPI)                                             │    │ │
│  │  │                                                                          │    │ │
│  │  │  Endpoints:                                                              │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  POST /encode                                                     │  │    │ │
│  │  │  │  {                                                                │  │    │ │
│  │  │  │    "text": "தமிழ் ஒரு அழகான மொழி",                              │  │    │ │
│  │  │  │    "return_tokens": true                                          │  │    │ │
│  │  │  │  }                                                                │  │    │ │
│  │  │  │  → {"ids": [123, 456, ...], "tokens": ["தமிழ்", "ஒரு", ...]}    │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────────┘  │    │ │
│  │  │                                                                          │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  POST /decode                                                     │  │    │ │
│  │  │  │  {                                                                │  │    │ │
│  │  │  │    "ids": [123, 456, 789]                                         │  │    │ │
│  │  │  │  }                                                                │  │    │ │
│  │  │  │  → {"text": "தமிழ் ஒரு அழகான மொழி"}                            │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────────┘  │    │ │
│  │  │                                                                          │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  POST /batch_encode                                               │  │    │ │
│  │  │  │  {                                                                │  │    │ │
│  │  │  │    "texts": ["text1", "text2", ...]                               │  │    │ │
│  │  │  │  }                                                                │  │    │ │
│  │  │  │  → {"results": [{...}, {...}, ...]}                               │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────────┘  │    │ │
│  │  │                                                                          │    │ │
│  │  │  ┌──────────────────────────────────────────────────────────────────┐  │    │ │
│  │  │  │  GET /health                                                      │  │    │ │
│  │  │  │  → {"status": "healthy", "version": "1.0.0"}                      │  │    │ │
│  │  │  └──────────────────────────────────────────────────────────────────┘  │    │ │
│  │  │                                                                          │    │ │
│  │  │  Features:                                                               │    │ │
│  │  │  • Rate Limiting (1000 req/min per API key)                             │    │ │
│  │  │  • Authentication (API Key / OAuth)                                     │    │ │
│  │  │  • Request Validation                                                   │    │ │
│  │  │  • Error Handling                                                       │    │ │
│  │  │  • OpenAPI/Swagger Documentation                                        │    │ │
│  │  └────────────────────────────────────────────────────────────────────────┘    │ │
│  │                                                                                   │ │
│  │  ┌────────────────────────────────────────────────────────────────────────┐    │ │
│  │  │  Container & Orchestration                                              │    │ │
│  │  │                                                                          │    │ │
│  │  │  ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐ │    │ │
│  │  │  │  Docker Image    │    │  Kubernetes      │    │  Cloud Deploy    │ │    │ │
│  │  │  │                  │    │  Deployment      │    │                  │ │    │ │
│  │  │  │  • Base: Python  │    │  • Replicas: 3   │    │  • AWS ECS       │ │    │ │
│  │  │  │  • Size: <500MB  │    │  • Auto-scaling  │    │  • GCP Cloud Run │ │    │ │
│  │  │  │  • Multi-stage   │    │  • Load Balancer │    │  • Azure ACI     │ │    │ │
│  │  │  └──────────────────┘    └──────────────────┘    └──────────────────┘ │    │ │
│  │  │                                                                          │    │ │
│  │  │  Build: docker build -t tamiluku/amb-api:latest .                       │    │ │
│  │  │  Run:   docker run -p 8000:8000 tamiluku/amb-api:latest                 │    │ │
│  │  └────────────────────────────────────────────────────────────────────────┘    │ │
│  │                                                                                   │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                         │
└───────────────────────────────────────────────────────────────────────────────────────┘
```

